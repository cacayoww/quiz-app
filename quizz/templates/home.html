{% extends 'base.html' %} {% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}" />
{% endblock %} {% block title %}Home{% endblock %} {% block content %}

<div class="container py-4">
  {% with messages = get_flashed_messages(with_categories=True) %} {% if messages %} {% for category, message in messages %}
  <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  {% endfor %} {% endif %} {% endwith %}
  <div class="row" style="margin-bottom: 24px">
    <div class="col-md-6" style="padding: 0px">
      <form method="POST" id="search-form" class="d-flex">{{ form.hidden_tag() }} {{ form.city(id="city-input", class="form-control me-2", placeholder="Search", autocomplete="off", required=false) }}</form>
      <div id="suggestions" class="suggestions"></div>
    </div>
  </div>
  <div class="row" style="margin-bottom: 36px">
    <div class="w-100" style="background-color: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25)">
      <div class="d-flex w-100 justify-content-between mb-2">
        <p>{{ location }}</p>
        <p>{{ date }}</p>
      </div>
      <div class="d-flex w-100 justify-content-between">
        <h3>{{ temp }}°C</h3>
        <div style="text-align: end">
          <p>suhu siang: {{ day_temp }}°C</p>
          <p>suhu malam: {{ night_temp }}°C</p>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="d-flex p-0" style="gap: 24px; overflow-x: scroll">
      {% for f in forecast %}
      <div class="weather-card">
        <p style="font-weight: bold">{{ f['day']}}</p>
        <p>{{ f['time']}}</p>
        <img src="{{ f['icon'] }}" alt="" />
        <!-- <svg width="61" height="45" viewBox="0 0 61 45" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M34.25 11.25C43.4937 11.25 48.7362 17.1525 49.4975 24.2775H49.73C55.6775 24.2775 60.5 28.9163 60.5 34.6388C60.5 40.3613 55.6775 45 49.73 45H18.77C12.8225 45 7.99999 40.3613 7.99999 34.6388C7.99999 28.9163 12.8225 24.2775 18.77 24.2775H19.0025C19.7712 17.1037 25.0062 11.25 34.25 11.25ZM24.47 1.30708e-07C29.93 1.30708e-07 34.6925 3.105 37.0437 7.66875C36.1169 7.55458 35.1838 7.49822 34.25 7.5C25.2875 7.5 18.755 12.4013 16.4225 19.8225L16.19 20.625L16.0175 21.3263L15.3987 21.4388C13.1336 21.8988 11.0178 22.9129 9.24047 24.3906C7.46312 25.8682 6.07965 27.7632 5.21374 29.9063C3.42728 28.8178 2.03451 27.188 1.2379 25.2537C0.441288 23.3194 0.282356 21.1814 0.784208 19.1506C1.28606 17.1198 2.42254 15.302 4.02843 13.9614C5.63433 12.6208 7.62593 11.8273 9.71374 11.6962L10.5462 11.6775C11.1245 8.40498 12.8371 5.44077 15.3834 3.30528C17.9296 1.1698 21.1468 -0.00045156 24.47 1.30708e-07Z"
            fill="#F7F7F7"
          />
        </svg> -->
        <p style="font-weight: bold">{{ f['weather'] }}</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  const input = document.getElementById("city-input");
  const suggestionsDiv = document.getElementById("suggestions");

  input.addEventListener("keydown", async (e) => {
    if (e.key === "Enter") {
      e.preventDefault();

      const query = input.value.trim();
      if (query.length < 1) {
        suggestionsDiv.innerHTML = "";
        return;
      }

      const resp = await fetch(`/get_cities?q=${query}`);
      const cities = await resp.json();

      console.log(cities);

      suggestionsDiv.innerHTML = "";
      cities.forEach((city) => {
        const div = document.createElement("div");
        div.textContent = city;
        div.classList.add("suggestion-item");
        div.onclick = () => {
          input.value = city;
          suggestionsDiv.innerHTML = "";
          document.getElementById("search-form").submit();
          input.value = "";
        };
        suggestionsDiv.appendChild(div);
      });
    }
  });

  // klik di luar hide suggestions
  document.addEventListener("click", (e) => {
    if (e.target !== input) {
      suggestionsDiv.innerHTML = "";
    }
  });

  window.addEventListener("load", () => {
    document.getElementById("city-input").value = "";
  });
</script>
{% endblock %}
